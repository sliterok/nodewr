<html>
<head>
	<title>WorldRoulette - Карта</title>
	<script>
	try {
		eval("let a5912839;");
	} catch (e){
		window.stop();
		alert('You have very old browser! Please update it in order to use this site!');
	}
	</script>
	<!--<meta name="theme-color" content="#373a3c" />-->
	<meta name="msapplication-navbutton-color" content="#373a3c">
	<meta name="apple-mobile-web-app-status-bar-style" content="#373a3c">

	<!--God, I hate favicons-->
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png?v=3">
	<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png?v=3">
	<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png?v=3">
	<link rel="manifest" href="/manifest.json?v=3">
	<link rel="mask-icon" href="/assets/icons/safari-pinned-tab.svg?v=3" color="#5bbad5">
	<link rel="shortcut icon" href="/assets/icons/favicon.ico?v=3">
	<meta property="og:image" content="/assets/wr new sq.png"/>
	<meta name="apple-mobile-web-app-title" content="WorldRoulette">
	<meta name="application-name" content="WorldRoulette">
	<meta name="msapplication-config" content="/assets/icons/browserconfig.xml?v=3">
	<meta name="theme-color" content="#3c8578">
	<!--Bless the God it's ended-->


	<!--<link rel="stylesheet" href="/font-awesome.min.css">-->
	<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
	<link href="https://fonts.googleapis.com/css?family=Montserrat:700|Roboto&subset=cyrillic" rel="stylesheet">
	<link rel="stylesheet" href="/jquery-jvectormap-2.0.3.css" type="text/css" media="screen" />
	<!--<link rel="stylesheet" type="text/css" href="styles.css">-->
	<link rel="stylesheet" type="text/css" href="newstyles.css">
	<link rel="stylesheet" type="text/css" href="flag-icon.min.css">

	<script src="https://twemoji.maxcdn.com/2/twemoji.min.js?2.7"></script>
	<script src="/jquery.js"></script>
	<script src="/jquery.mobile.custom.min.js"></script>
	<!--<script src="https://cdn.rawgit.com/eligrey/FileSaver.js/master/FileSaver.min.js"></script>-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
	<script>
	let socket = io('https://socket.worldroulette.ru:444', {secure: true});
	$('#no-connection').css('display', 'none');
	socket.on('connect', function() {
		console.error('socket CONNECT')
		$('#no-connection').css('display', 'none');
	});
	socket.on('disconnect', function() {
		console.error('socket DISCONNECT')
		$('#no-connection').css('display', '');
	});
	</script>
	<script src="https://www.google.com/recaptcha/api.js" async defer></script>
	<!--<script src='https://www.google.com/recaptcha/api.js?render=6LdGf1wUAAAAADreTvxquXjWuuTcfNcnTf5gwG4Q' data-badge="inline"></script>-->
	<script src="https://authedmine.com/lib/authedmine.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-messaging.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyDpI6H-ZFjrdZPoHkl0uCg0E0WM87Y461U",
			authDomain: "worldroulette-ru.firebaseapp.com",
			databaseURL: "https://worldroulette-ru.firebaseio.com",
			projectId: "worldroulette-ru",
			storageBucket: "worldroulette-ru.appspot.com",
			messagingSenderId: "662779542610"
		};
		firebase.initializeApp(config);
		const messaging = firebase.messaging();
		messaging.usePublicVapidKey("BCnxfOgI0TYUmBkv3HsePjHdRvTwQY_jLd2MuspPBkJzJ9oi2_J_3D5qNAKohVbfBmjI0fdLdsULuAIOrM-4Kps");
		
		messaging.onTokenRefresh(function() {
			messaging.getToken().then(function(token) {
				console.log('Token refreshed.');
				$.post('/pushToken', {token: token}, data => alertify.log(data))
			}).catch(function(err) {
				console.log('Unable to retrieve refreshed token ', err);
			});
		});
	</script>
	<script src="/jscolor.min.js"></script>
	<script src="/translation.js"></script>
	<script src="/factions.js"></script>
	<script src="/chat.js"></script>
	<script src="/captcha.js"></script>
	<script src="/alertify.js"></script>
	<script src="/map.js"></script>
	<script src="/bootstrap/bootstrap.min.js"></script>
	<script src="/jquery-jvectormap-2.0.3.min.js"></script>
	<script src="/world_mill_en.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-78463564-1', 'auto');
		ga('send', 'pageview');
	</script>
	<script src="/webpjs-0.0.2.min.js" async></script>
</head>
<body>
	<div class="loadscreen" onclick="$(this).fadeOut();">
		<div class="spinner">
			<img src="/assets/wr map.webp" style="width: 100%;" alt="WR">
		</div>
		<div class="progressbar">
			<div><span>0%</span></div>
		</div>
	</div>
	<script>
    var notifysound = new Audio('/assets/notify.wav');
	function resize(){
		if(map) map.updateSize();/*
		if($(window).width() < 1196){
			var navbarh = $('.navbar').outerHeight();
			$('#map').height('50%');
			$('.mapshadow').height('calc(100% - '+navbarh+'px)');
			$('#chat').css('height', '');
			$('#chatwindow').css('height', '');
			$('#menu').css('height', '');
		} else {
			$('#map').height('calc(100%');
			$('#menu').css('height', '18em');
			$('#chat').css('height', 'calc(100% - 18em - 15px)');
			var chatty = $('#chatty').height();
			var chat = $('#chat').height();
			var entirechat = chat-chatty;
			$('#chatwindow').css('height', entirechat+'px');
		};*/
	}
	window.onresize = resize;
	alertify.maxLogItems(20);
	alertify.delay(20000);
	alertify.parent(document.body);
	alertify.closeLogOnClick(true);
	alertify.logPosition("bottom left");
    alertify.setLogTemplate(function (input) {
		if(typeof input == "object"){
			notifysound.volume = audioenabled/500;
			notifysound.currentTime = 0;
			notifysound.play();
			return `<img src="/assets/fox.webp" style="height: 3em">`+input[0];
		}
        return `<img src="/assets/fox.webp" style="height: 3em">`+input;
    });
	//If something goes wrong. Probably because of this:
	//window.setInterval(resize, 1000);
	</script>
	<div class="well row" style="margin: 0;">
		<span class="player-tooltip"></span>
		<div class="well map col-xl-8">
			<span class="well mapdib top"></span>
			<div class="mapshadow"></div>
			<div id="map" style="visibility: hidden">
				<button class="leave" onclick="multiMap.goBack();map = multiMap.maps['world_mill'];$(this).hide()" style="display:none">Go Back</button>
			</div>
		</div>
		<div class="col-xl-4 no-print main">
			<div class="well header">
				<a class="navbar-brand" href="javascript:location.reload()">
					<img src="/assets/wr new.webp" style="height: 1em" class="d-inline-block align-middle" alt="">
					WorldRoulette
				</a>
				<span class="network fa-lg">
					<span class="fa-layers fa-fw">
						<i class="fa fa-signal" aria-hidden="true"></i>
						<i id="no-connection" class="fa fa-ban text-danger" aria-hidden="true" style="display: none"></i>
					</span>
					<span class="fa-layers fa-fw">
						<i class="fa fa-users" aria-hidden="true"></i>
						<span id="online" class="fa-layers-counter fa-2x"></span>
					</span>
				</span>
				<div class="flex-break"></div>
				<button class="btn btn-md" id="menubtn"><i class="fas fa-sliders-h" data-fa-transform="rotate-90"></i> Settings</button>
				<button class="btn btn-md" id="fbtn"><i class="fa fa-address-book" aria-hidden="true"></i> Fractions</button>
				<button class="btn btn-md" id="faqbtn"><i class="fa fa-question-circle" aria-hidden="true"></i> FAQ</button>
				<!--<button class="btn btn-md" id="takescreen">
					<i class="fa fa-camera-retro" aria-hidden="true" style="line-height: 1.25"></i>
				</button>-->
				<hr>
			</div>
			<div class="well controls">
				<h3 style="margin: 11px" class="page-header"><i class="fa fa-bars" aria-hidden="true"></i> Map menu</h3>
				<button id="capt" class="btn btn-big" style="width: 100%">
					<div id="capttext">Attack</div>
					<i id="captpause" class="fab fa-connectdevelop fa-spin fa-fw" style="display: none"></i>
				</button>
				
				<span>Energy: </span><span id="power" class="red">0</span>

				<div id="captcha" style="display: none;">
					<div style="display: inline-block; margin-top: 10px;" class="g-recaptcha" data-sitekey="6Lc9Fz4UAAAAAJx4scoYQlrcFT5BlErwwtQDWCF6" data-theme="dark"></div>
				</div>
				
				<br>
				<button class="btn btn-md" data-toggle="collapse" href="#miner" role="button" aria-expanded="false" aria-controls="miner">Miner</button>
				<div id="miner" class="collapse">
					<button id="toggleMiner" class="btn btn-md">Start mining</button>
					<span>Miner state: </span>
					<span id="minerStatus" class="red">OFF</span>
					<br>
					<span>Hashes: </span>
					<span id="foundHashes">0</span>,
					<span>Hash/sec: </span>
					<span id="HPS">0</span>,
					<span>Accepted: </span>
					<span id="acceptedHashes">0</span>
					<br>
					<span>Miner throttling: </span><span>70%</span><input type="range" id="minerRange" min="0" max="10000" value="7000">
				</div>

				<input type="text" id="givenick" style="margin-top: 10px; width:inherit;" placeholder="user id" type="text"/>
				<!--<button id="giveall">Передать всё</button>-->
				<button id="give" class="btn btn-md" style="margin-top: 0px">Give</button>
				<div>Contact admin:
					<a target="_blank" href="https://t.me/worldroulette"><i class="fab fa-telegram" aria-hidden="true"></i></a>
					/
					<a target="_blank" href="https://vk.com/wororu"><i class="fab fa-vk"></i></a>
				</div>
				<hr>
			</div>

			<div class="well chat">
				<h3 id="chatheader"><i class="fas fa-comments"></i> Chat</h3>
				<input style="white-space: nowrap; width: 100%; display: block;" id="chatmsg" type="text" maxlength="200" placeholder="Message">
				<button id="sendmsgbutton" style="width: 100%; display: block;" onclick="sendMessage();">Send</button>
				<script type="text/javascript">
				function msgval(name)
				{
					doc = document.getElementById("chatmsg")
					doc.value += name + " ";
					doc.focus();
				}
				</script>
			</div>

			<div class="well chatwindow" id="chatwindow"></div>
		</div>
	</div>

	<div id="faq" class="menu" style="display:none">
		<button class="back"><i class="fas fa-arrow-left"></i> Go Back</button>
		<img src="/assets/wr new.webp" class="d-block mx-auto" style="width: 40vw"/>
		You are logged in to your account, congratulations! <br>
		Now you can play this wonderful game! <br>
		How? <br>
		Choose any country and click on it <br>
		Then click on the "Attack" button, after that you'll get a number: <br>
		Two identical last digits (11,22), then you took away 1 defence <br>
		Three identical last digits (111), then you took away 2 defence <br>
		Four identical last digits (1111), then you took away 4 defence <br>
		If you are not so lucky, then try again! <br>
		1 energy = 1 roll <br>
		Mining gives +1 energy per 512 hashes <br>
		If you mined more than 100 energy, then you need to enter Captcha <br>
		Solving captcha gives 15 energy <br>
		<b style = "max-width: 40vw; display: inline-block">THE MAP COULD BE ZOOMED WITH A MOUSE WHEEL OR TWO FINGER TOUCH </b><br>
		You can change color or name in settings <br>
		You can write private messages! /msg id message
		<hr>
		<h3>Famous personalities</h3>
		<div class="text-center"><b>(2)</b> <span class="chatname 675" data-name-color="2"></span></div>
		<div class="text-center"><b>(2)</b> <span class="chatname 945" data-name-color="2"></span></div>
		<div class="text-center"><b>(3)</b> <span class="chatname 648" data-name-color="4"></span></div>
		<div class="text-center"><b>(5)</b> <span class="chatname 1231" data-name-color="0"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 1954" data-name-color="2"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 806" data-name-color="3"></span></div>
		<div class="text-center"><b>(2)</b> <span class="chatname 908" data-name-color="4"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 2193" data-name-color="1"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 2242" data-name-color="1"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 2481" data-name-color="0"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 2510" data-name-color="0"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 1690" data-name-color="0"></span></div>
		<div class="text-center"><b>(1)</b> <span class="chatname 2534" data-name-color="2"></span></div>
	</div>

	<div id="mmenu" style="display:none" class="menu">
		<button class="back"><i class="fas fa-arrow-left"></i> Go Back</button>
		<button class="login" id="changecolorbtn">Color</button> :
		<input type="text" class="jscolor login" id="newcolor" value="#FF00FF" data-jscolor="{onFineChange:'return false'}"/><br>
		<small class="form-text text-muted">New color with <a href="https://en.wikipedia.org/wiki/Web_colors">HEX</a> format</small>
		<button class="login" id="changenamebtn">Name</button> :
		<input type="text" class="login" id="newname" placeholder="Alex"/><br>
		<small class="form-text text-muted">Enter new name</small>
		<button class="login" id="changeemojibtn">Unique emoji</button> :
		<input type="text" class="login" id="newemoji" placeholder="😊"/><br>
		<small class="form-text text-muted">Available only after takeover of the world</small>
		<button class="login" id="changeflagbtn">Coat of arms</button> :
		<input type="file" id="newflag" accept="image/x-png,image/gif,image/jpeg"><br>
		<small class="form-text text-muted">Coat of arms for your nation!</small>
		<button class="login" id="logout">Sign off</button><br>
		<button class="login" onclick="location.reload(true)">Hard reload</button><br>
		<hr>
		<span>Volume</span><input type="range" id="soundrange" min="0" max="10000"><span></span><br>
		<button class="login" id="changebkgbtn">Simplified background</button>
		<button class="login" id="togtopbtn">ON/OFF top</button>
		<button class="login" onclick="confirmSubscribe()">Subscribe to notifications</button>
	</div>

	<div id="fmenu" style="display:none" class="menu">
		<button class="back"><i class="fas fa-arrow-left"></i> Go Back</button>
		<div id="fadmin" style="display:none">
			<h3>Faction management</h3>
			<button class="login" id="changefcolorbtn">Color</button>:
			<input type="text" style="margin-bottom: 10px" class="jscolor login" id="newfcolor" value="#00FF00" data-jscolor="{onFineChange:'return false'}"/><br>
			<button class="login" id="changefnamebtn">Name</button>:
			<input type="text" style="margin-bottom: 10px" class="login" id="newfname" placeholder="European union"/><br>
			<button class="login" id="invitetofbtn">Invite user</button>:
			<input type="text" style="margin-bottom: 10px" class="login" id="invitetof" placeholder="ID"/><br>
			<button class="login" id="deletef">Delete fraction</button>
			<h3>Faction users</h3>
			<div class="factionplayers"></div>
		</div>
		<div id="fnone">
			<h3>Create faction</h3>
			<input type="text" style="margin-bottom: 10px" class="jscolor login" id="fcolor" value="#696969" data-jscolor="{onFineChange:'return false'}"/><br>
			<input type="text" style="margin-bottom: 10px" class="login" id="fname" placeholder="name"/><br>
			<button class="login" id="createf">Create</button>
			<h3>Faction invites</h3>
			<div id="invites"></div>
		</div>
		<div id="fuser" style="display:none">
			<h3>Faction users</h3>
			<div class="factionplayers"></div><br>
			<button class="login" id="leavef">Leave faction</button>
		</div>
	</div>

	<div id="subprompt" class="menu" style="display:none">
		One of your territories was attacked. <br>
		Now you are online, but next time it can be different. <br>
		Do you want to subscribe to offline notifications for this device? <br>
		<button class="btn" onclick="confirmSubscribe()">Yes I do</button> <button class="btn">No, thanks</button>
	</div>

	<div id="mtop" style="display:none;" class="menu"></div>
	<div class="dropdown clearfix player-menu">
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu" style="display:block;position:static;">
			<li><button tabindex="-1" class="player-menu-reply">Reply</button></li>
			<li><button tabindex="-1" class="player-menu-give">Give</button></li>
			<li><button tabindex="-1" class="player-menu-msg">Private message</button></li>
		</ul>
	</div>
	<script>
		let pmenu = $('.player-menu');
		$('.player-menu-reply').click(e=>{
			chatmsg.val(`$${pmenu.data('pid')}, `);
			chatmsg.focus();
		})
		$('.player-menu-give').click(e=>{
			$('#givenick').val(pmenu.data('pid')).focus();
		})
		$('.player-menu-msg').click(e=>{
			chatmsg.val(`/msg ${pmenu.data('pid')} `);
			chatmsg.focus();
		})
		$(window).click(e=>{
			pmenu.css({
				display: '',
				opacity: '',
				left: '',
				top: ''
			});
		})
	</script>
</body>
</html>
